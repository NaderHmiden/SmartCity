# Étape 1 : Build Maven
FROM maven:3.9.6-eclipse-temurin-17 AS build

# Copier tout le projet dans l'image
WORKDIR /app
COPY . .

# Télécharger les dépendances + compiler le projet
RUN mvn -B -DskipTests package

# Étape 2 : Exécuter l'application
FROM eclipse-temurin:17-jdk

# Installer JavaFX (nécessaire)
RUN apt-get update && apt-get install -y \
    libgtk-3-0 \
    libasound2 \
    libgl1-mesa-glx \
    && rm -rf /var/lib/apt/lists/*

# Copier l'application compilée
WORKDIR /app
COPY --from=build /app/target/SmartCity123-1.0-SNAPSHOT.jar app.jar

# Commande pour lancer JavaFX
CMD ["java", "-jar", "app.jar"]
